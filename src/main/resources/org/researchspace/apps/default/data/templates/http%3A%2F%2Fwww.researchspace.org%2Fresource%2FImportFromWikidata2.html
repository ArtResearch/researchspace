<div class="page__section-container">
  <h5 style="margin: 0px 0 7px;">Search on Wikidata</h5>

  <semantic-search>
    <semantic-search-query-keyword  domain='<http://www.cidoc-crm.org/cidoc-crm/E21_Person>'
                                    placeholder="Search person"
                                    min-search-term-length=2
                                    tokenize-lucene-query=false
                                    escape-lucene-syntax=false
                                    debounce=1000
                                    debounce=500
                                    query='
                                    PREFIX wikidataentity: <http://www.researchspace.org/resource/system/service/wikidataentity/>
                                            SELECT ?subject WHERE { 
                                              ?subject wikidataentity:search ?__token__ .
                                              ?subject wikidataentity:language "en" .
                                              ?subject wikidataentity:id ?wikidataId .
                                              ?subject wikidataentity:concepturi ?concepturi .
                                              ?subject wikidataentity:label ?wikidataEntityLabel .
                                              ?subject wikidataentity:description ?description .

                                            }'
    ></semantic-search-query-keyword>
    <!-- add label-->
    <semantic-search-result-holder>
      <div style="margin-top: 25px;">
        <semantic-search-result>
          <div class="personResultsTable">
            <semantic-context repository='wikidata-entity'>
              <semantic-table id='semantic-search-result-table'
                              query='SELECT DISTINCT ?subject ?description ?wikidataId  WHERE {
                                      BIND(?subject as ?iri) .
                                    } ORDER BY ?subject'

                              options='{"showFilter":false, "resultsPerPage":10}' 
                              column-configuration='[
                                      
                                      {"displayName": "Description (from Wikidata)", "cellTemplate": "{{> wikidata}}"},
                                     
                                      {"displayName": "Actions", "cellTemplate": "{{> actions}}" }
                                    ]'   
              >

                 <template id='wikidata'>
                  <div>
                    <!-- 
https://query.wikidata.org/#SELECT%20%3Fproperty%20%3FpropertyLabel%20%3Fvalue%20%3FvalueLabel%20WHERE%20%7B%0A%20SERVICE%20%3Chttps%3A%2F%2Fquery.wikidata.org%2Fsparql%3E%20%7B%0A%20%20wd%3AQ5586%20%3Fp%20%3Fstatement%20.%0A%20%20wd%3AQ5586%20wdt%3AP31%20wd%3AQ5%20.%0A%20%20%3Fstatement%20%3Fps%20%3Fvalue%20.%0A%20%20%3Fproperty%20wikibase%3Aclaim%20%3Fp.%0A%20%20%3Fproperty%20wikibase%3AstatementProperty%20%3Fps.%0A%20%20%0A%20%20SERVICE%20wikibase%3Alabel%20%7B%0A%20%20%20%20bd%3AserviceParam%20wikibase%3Alanguage%20%22en%22%20.%0A%20%20%20%20%3Fproperty%20rdfs%3Alabel%20%3FpropertyLabel%20.%0A%20%20%20%20%3Fvalue%20rdfs%3Alabel%20%3FvalueLabel%20.%0A%20%20%7D%0A%7D%0A%7D%0AORDER%20BY%20%3Fproperty%20%3Fvalue%0A
-->
                    {{#if wikidataId.value}} {{wikidataId.value}}, {{description.value}}
                      <semantic-context repository='default'>
                        <semantic-query query='
                                          PREFIX wikibase: <http://wikiba.se/ontology#>
                                          PREFIX bd: <http://www.bigdata.com/rdf#>
                                          PREFIX mwapi: <https://www.mediawiki.org/ontology#API/>
                                          PREFIX wdt: <http://www.wikidata.org/prop/direct/>
                                          PREFIX wd: <http://www.wikidata.org/entity/>
                                          
                                          SELECT ?label WHERE { 
                                            BIND(IRI(CONCAT(STR(wd:), "{{wikidataId.value}}")) AS ?wikidataEntity) .
                                            SERVICE <https://query.wikidata.org/sparql> {  
                                              # is it a person
                                              ?wikidataEntity wdt:P31 wd:Q5 .

                                              # family name
                                              ?wikidataEntity wdt:P734 ?familyNameIRI .
                                              # given name
                                              ?wikidataEntity wdt:P735 ?givenNameIRI .
                                            
                                              SERVICE wikibase:label { 
                                                bd:serviceParam wikibase:language "en". 
                                                ?familyNameIRI rdfs:label ?familyName .
                                                ?givenNameIRI rdfs:label ?givenName .                                     
                                              }

                                              BIND(CONCAT(?givenName," ",?familyName) as ?label)
                                            }
                                          }'
                                        
                            template='{{> template}}'>

                            <template id='template'>
                                <strong>{{bindings.0.label.value}}</strong>
                            </template>
                            <template id='noResultTemplate'>
                            </template>
                        </semantic-query>
                      </semantic-context>
                    {{/if}}
                  </div>
                </template>
                
                <template id='actions'>
                  <div>
                    
                  </div>
                </template>

              </semantic-table>
            </semantic-context>
          </div>
        </semantic-search-result>
      </div>
    </semantic-search-result-holder>
    
  </semantic-search>
</div>
