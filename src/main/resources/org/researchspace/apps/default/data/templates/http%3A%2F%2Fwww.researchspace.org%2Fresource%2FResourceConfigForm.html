<semantic-form  id='{{viewId}}-vocab-form' 
                post-action="event"
                subject='{{node}}'
                persistence='{"type": "sparql", "targetGraphIri": "{{scheme}}"}'
                new-subject-template='{{scheme}}/data/{{{{raw}}}}{{resource_label}}{{{{/raw}}}}'
                fields='[[
                fieldDefinitions
                  classtype="http://www.w3.org/1999/02/22-rdf-syntax-ns#type"
                  resource_configuration_is_listed_in="http://www.researchspace.org/pattern/system/entity/is_listed_in"

                  resource_configuration_type="http://www.researchspace.org/pattern/system/resource_configuration/configuration_type"
                  
                  resource_label="http://www.researchspace.org/pattern/system/resource_configuration/resource_label"
                  resource_form="http://www.researchspace.org/pattern/system/resource_configuration/resource_form"

                  resource_ontology_type="http://www.researchspace.org/pattern/system/resource_configuration/resource_ontology_type"
                  resource_system_type="http://www.researchspace.org/pattern/system/resource_configuration/resource_system_type"

                  resource_broader_property="http://www.researchspace.org/pattern/system/resource_configuration/resource_broader_property"
                  resource_membership_property="http://www.researchspace.org/pattern/system/resource_configuration/resource_membership_property"
                  
                  resource_label_sparql_pattern="http://www.researchspace.org/pattern/system/resource_configuration/resource_label_sparql_pattern"
                  resource_restriction_sparql_pattern="http://www.researchspace.org/pattern/system/resource_configuration/resource_restriction_sparql_pattern"
                  resource_order_sparql_pattern="http://www.researchspace.org/pattern/system/resource_configuration/resource_order_sparql_pattern"
                  
                  entity_has_navigation="http://www.researchspace.org/pattern/system/resource_configuration/has_navigation_menu"
                  has_facet_kp="http://www.researchspace.org/pattern/system/resource_configuration/has_facet_kp"
                  entity_has_view="http://www.researchspace.org/pattern/system/resource_configuration/has_view"
               ]]'
               >

    <div style="display: flex; align-items: center; justify-content: space-between;">
      {{#switch mode}}
        {{#case "new" break=true}}
            <h2 class="resource-editDetails-form-title">New configuration</h2>
        {{/case}}

        {{#case "edit" break=true}}
          <h2 class="resource-editDetails-form-title"><mp-label iri='{{node}}'></mp-label></h2>
        {{/case}}
      
        {{#case "deleted" break=true}}
          <h2 class="resource-editDetails-form-title">Deleted configuration: <mp-label iri='{{node}}'></mp-label></h2>
        {{/case}}

        {{#default}}
          <div></div>
        {{/default}}
      {{/switch}}

      <div style="display: flex; align-items: center; gap: 5px;">
        {{#ifCond mode "!==" "new"}}
          <mp-copy-to-clipboard text='{{node}}' message='IRI has been copied'>
            <button class="btn btn-default btn-textAndIcon" title="Copy IRI" style="height: 41px;">
              <rs-icon icon-type="round" icon-name="content_copy"></rs-icon>
              Copy IRI
            </button>
          </mp-copy-to-clipboard>
        {{/ifCond}}
        <mp-event-trigger id='{{viewId}}-form-refresh-trigger' 
                          type='Component.TemplateUpdate' 
                          targets='["{{viewId}}-resource-config-term-forms"]'
                          data='{"mode": "{{mode}}",
                                "frameId": "{{viewId}}",
                                {{#if broader}}"broader": "{{broader}}",{{/if}}
                                {{#if broaderProperty}}"broaderPropertyIRI":"{{broaderProperty}}",{{/if}} 
                                "iri": "{{node}}"}' >
          <button class="btn btn-default btn-textAndIcon" title="Refresh form" style="height: 41px;">
            <rs-icon icon-type="round" icon-name="refresh"></rs-icon>
              Refresh
            </button>
        </mp-event-trigger>

        <div class="page__section-container-whiteBg" style="display: flex; align-items: center; gap:5px; padding: 7px 12px; margin: 0;">
          <div class='color-secondary' style="font-weight: 600;">System</div>
          
          <div class="menu-toggle toggle-label-left">
            <semantic-form-checkbox-input class="toggle" for="resource_configuration_type" render-header="false"
              label="system">
            </semantic-form-checkbox-input>
          </div>
        [[!--  <mp-popover>
            <mp-popover-trigger placement="bottom"  trigger='["click","hover","focus"]'> 
              <sup><rs-icon icon-type="round" icon-name="help_center"></rs-icon></sup>
            </mp-popover-trigger>
            <mp-popover-content>
              <div>Content</div>
            </mp-popover-content>
          </mp-popover> --]]
        </div>
      </div>
    </div>

    <bs-tabs id="tabs">

      <bs-tab event-key="1" title="Details">

          <semantic-form-hidden-input for="classtype" default-values='["http://www.cidoc-crm.org/cidoc-crm/E73_Information_Object", "http://www.researchspace.org/resource/system/resource_configuration"]'></semantic-form-hidden-input>
          <semantic-form-hidden-input for="resource_configuration_is_listed_in" default-value="http://www.researchspace.org/resource/system/resource_configurations_container"> </semantic-form-hidden-input>
        
          <div class="form-section-content">
            <semantic-form-text-input for="resource_label" placeholder="Enter the resource label (e.g. Place, Actor, Collection item, Concept, etc.)" label="Resource label"></semantic-form-text-input>
            <div style="display:flex; gap:5px; align-items: end; margin-top: 21px;">
              <div style="flex: 1;">
                <semantic-form-text-input for="resource_form" default-value="http://www.researchspace.org/resource/system/forms/" label="Resource form"
                placeholder="Enter IRI of the form that should be used to edit the resource"></semantic-form-text-input>
              </div>
              {{#if node}}
                  <semantic-query query='SELECT ?form WHERE { <{{node}}> <http://www.researchspace.org/pattern/system/resource_configuration/resource_form> ?form}'>
                    <template id='template'>
                      <semantic-link-container uri='{{bindings.0.form.value}}' urlqueryparam-action='edit' target='_blank'>
                          <button class="btn btn-primary btn-input-inline btn-textAndIcon">
                            <rs-icon icon-type="round" icon-name="edit" title="Edit form"></rs-icon>
                            Edit form
                          </button>
                      </semantic-link-container>
                    </template>
                  </semantic-query>
              {{/if}}
            </div>

          </div>

          <div class="form-section-header">
            <h3>Resource types</h3>
            <div>An ontology type (e.g. CIDOC-CRM Man-Made object, Place, etc.) and a system type are required in the resource configuration.</div>
          </div>
          
          <div class="form-section-content">
              <semantic-form-tree-picker-input for="resource_ontology_type" 
                                              label="Ontology type (CIDOC-CRM, Skos, etc.)"
                                              placeholder="Select the ontology type (e.g. CIDOC-CRM Man-Made object, Place, etc.)" 
                                              close-dropdown-on-selection='true'
                                              query-item-label='SELECT ?label WHERE {
                                                  ?item ((crm:P1_is_identified_by/rdfs:label)|rso:displayLabel|rdfs:label|skos:prefLabel) ?label.
                                                  FILTER (lang(?label) = "en")
                                                }'
                                                
              ></semantic-form-tree-picker-input>

              <semantic-form-tree-picker-input for='resource_system_type' 
                                              label="System type"
                                              placeholder="Select an additional system type to be associated to the resource" 
                                              close-dropdown-on-selection='true'
                                              tree-patterns='{"scheme": "<http://www.researchspace.org/resource/vocab/system_entity>", 
                                                                "schemePattern": "?item <http://www.cidoc-crm.org/cidoc-crm/P71i_is_listed_in> <http://www.researchspace.org/resource/vocab/system_entity>",
                                                                "relationPattern": "?item crm:P127_has_broader_term ?parent"}'

                                                scheme-page-button-config='{"iri": "http://www.researchspace.org/resource/ThinkingFrames",
                                                                            "view": "authority-content",
                                                                            "scheme": "http://www.researchspace.org/resource/vocab/system_entity",
                                                                            "tooltip": "Open list of system types"
                                                                          }'

                                                nested-form-template='{{{{raw}}}}{{> forms:Type nested=true editable=true 
                                                                      scheme="http://www.researchspace.org/resource/vocab/system_entity"
                                                                      entityType="system type" }}{{{{/raw}}}}'

                                                query-item-label='SELECT ?label WHERE {
                                                                    ?item skos:prefLabel ?label .
                                                                  }'
                                                >
              </semantic-form-tree-picker-input> 
          </div>
            
          <div class="form-section-header">
            <h3>Resource properties</h3>
            <div>Define a Membership property, if the resource is part of a vocabulary/collection, and a Broader property to refer to a broader resource.</div>
          </div>
          <div class="form-section-content">
            <semantic-form-tree-picker-input  for="resource_membership_property" 
                                              label="Membership property" 
                                              placeholder="Enter a property that connects the resource to the collection (e.g. skos:inScheme, crm:P71i_is_listed_in)"
                                              close-dropdown-on-selection='true'
            >
            </semantic-form-tree-picker-input>
            <semantic-form-tree-picker-input for="resource_broader_property" 
                                              label="Broader property" 
                                              placeholder="Enter property used to refer to a broader resource (e.g. skos:broader, crm:P127_has_broader_term, crm:P89_falls_within)"
                                              close-dropdown-on-selection='true'
                                              
              >
            </semantic-form-tree-picker-input>
          </div>

          <div class="form-section-header">
            <h3>SPARQL Patterns</h3>
            <div>Define specific SPARQL patterns to assign resource label, restriction and order.</div>
          </div>
          <div class="form-section-content">
            <semantic-form-text-input for="resource_label_sparql_pattern" label="Label (SPARQL pattern)" placeholder="Enter a SPARQL pattern for the resource label" > </semantic-form-text-input>
            <semantic-form-text-input for="resource_restriction_sparql_pattern" label="Restriction (SPARQL pattern)" placeholder="Enter a SPARQL pattern to apply a restriction" > </semantic-form-text-input>
            <semantic-form-text-input for="resource_order_sparql_pattern" label="Order by (SPARQL pattern)" placeholder="Enter a SPARQL pattern to get the order"> </semantic-form-text-input>
          </div>

      </bs-tab>
[[!--
      <bs-tab event-key="2" title="Navigation menu">

          <div>Enable and customise a <b>navigation menu</b> to be displayed in the Resource page.</div>

          <div class="menu-toggle toggle-label-right" style="margin-top: 30px;">
              <semantic-form-checkbox-input class="toggle" for='entity_has_navigation' label="Enable navigation menu"></semantic-form-checkbox-input>
          </div>
      
          {{#if node}}
            <semantic-if query='ASK WHERE { <{{node}}> <http://www.researchspace.org/pattern/system/resource_configuration/has_navigation_menu> ?form}'>
              <template id='then'>
                <inline-template template-iri='[[resolvePrefix "rsp:SimpleCollectionBrowser"]]'
                                options='{
                                          "collection": "{{node}}/navigation menu",
                                          "membershipProperty": "http://www.researchspace.org/pattern/system/resource_configuration/menu_item",
                                          "itemLabel": "Navigation item",
                                          "resourceView": "[[resolvePrefix "rsp:ResourceNavigationConfigForm"]]",
                                          "broaderProperty": "http://www.researchspace.org/pattern/system/resource_configuration/menu_broader_item",
                                          "labelSparqlPattern": "?item <http://www.researchspace.org/pattern/system/resource_configuration/menu_item_config>/<http://www.researchspace.org/pattern/system/resource_configuration/resource_label> ?label .",
                                          "viewId": "entity-navigation-config",
                                          "editable": true
                                          }'
                ></inline-template>
            </semantic-if>
          {{/if}}

      </bs-tab>

    <bs-tab event-key="3" title="Views">
      <div>Define the <b>views (eg. thumbnail, table, timeline, chart, etc.)</b>
      used to display the entities associated to the Resource in the Resource page.</div>
      <semantic-form-composite-input for='entity_has_view' label="Resource view"
                                    new-subject-template='view/{{{{raw}}}}{{UUID}}{{{{/raw}}}}'
                                    fields='[[
                                      fieldDefinitions
                                      view_has_label="http://www.researchspace.org/pattern/system/resource_configuration/view_has_label"
                                      view_has_order="http://www.researchspace.org/pattern/system/resource_configuration/view_has_order"
                                      view_has_template="http://www.researchspace.org/pattern/system/resource_configuration/view_has_template"
                                      ]]'
                                      >
                            <semantic-form-text-input for="view_has_label" placeholder="Enter label" label="View label"></semantic-form-text-input>
                            <semantic-form-text-input for="view_has_order" placeholder="Enter order (eg. 0, 1, 2)" label="View order for navigation dropdown"></semantic-form-text-input>
                            <semantic-form-text-input for="view_has_template" placeholder="Enter template IRI" label="View template"></semantic-form-text-input>
      </semantic-form-composite-input>
    </bs-tab>

    <bs-tab event-key="4" title="Facets">
      <div>Define the <b>facets</b> applied in the Resource page to filter the results.</div>
      <semantic-form-autocomplete-input for="has_facet_kp" placeholder="Select knowledge pattern" label="Facet knowledge pattern"></semantic-form-autocomplete-input>
    </bs-tab>
--]]
  </bs-tabs>

    [[!--
    <h3>Table View Config</h3>
    <semantic-form-composite-input for='has_table_view_config'>
      <semantic-form-composite-input for='table_view_column'>
        <semantic-form-text-input for="table_view_column_order"></semantic-form-text-input>
        <semantic-form-text-input for="table_view_column_kp"></semantic-form-text-input>
        <semantic-form-text-input for="table_view_column_template"></semantic-form-text-input>
      </semantic-form-composite-input>  
    </semantic-form-composite-input>
    --]]

    
    <semantic-form-errors></semantic-form-errors>

 [[> rsp:FormDefaultActions formEntity='configuration']] 
</semantic-form>
