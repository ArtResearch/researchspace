<div  class="resource-card {{#if (or narrativeCard knowledgeMapCard)}}resource-card__no-hover{{/if}}"
      style="{{#if autosize}}{{else if clipboardList}}width:100%; height:{{#if height}}{{height}}{{else}}200{{/if}}px;
              {{else}}width:{{#if width}}{{width}}{{else}}155{{/if}}px; 
                      height:{{#if height}}{{height}}{{else}}200{{/if}}px; 
                      margin:{{#if cardMargin}}{{cardMargin}}{{else}}0{{/if}}px;{{/if}}">
      [[!-- when autosize is set we don't set any fixed height and width, used in semantic narratives where user can resize the card --]]

  {{#if newKMCard}}
  {{else}}
    <div class="resource-card__header-actions">
      [[#if (hasPermission "forms:ldp:*")]]
        {{#if selectionToggle}}
          <mp-selection-toggle selection="item-selection-aggregator" tag="{{iri}}"></mp-selection-toggle>
        {{/if}}
      [[/if]]
      <div class="resource-card__buttons-container" style="{{#if clipboardList}}gap:5px{{/if}}">
    
        {{#if (or narrativeCard knowledgeMapCard)}}
          <mp-draggable iri='{{iri}}'>
            <button type="button" class="btn btn-default resource-card__button" title="Drag item {{#if knowledgeMapCard}}outside the map{{/if}}">
              <rs-icon icon-type="rounded" icon-name="drag_pan" symbol="true"></rs-icon>
            </button>
          </mp-draggable>
        {{/if}}

        {{> rsp:ResourceDropdownActions viewId=viewId
                                        iri=iri
                                        resourceConfig=resourceConfig
                                        resourceLabel=resourceLabel
                                        cardButton=true
        }}

        {{#if (or clipboardCard clipboardList)}}
          {{#if isSetItem}}
            <mp-anonymous-hidden>
              <mp-set-management-action-remove-set-item item="{{iri.value}}">
                <button type="button" class="btn btn-default resource-card__button" title="Remove from set">
                  <rs-icon icon-type="rounded" icon-name="close" symbol="true"></rs-icon>
                </button>
              </mp-set-management-action-remove-set-item>
            </mp-anonymous-hidden> 
          {{/if}}
        {{else if cardInDragAndDropInput}}
          <mp-event-trigger type='Form.DragAndDropInput.RemoveItem' targets='["{{inputId}}"]' data='{"iri": "{{iri}}"}'>
            <button type="button" class="btn btn-default resource-card__button" title="Remove">
              <rs-icon icon-type="rounded" icon-name="close" symbol="true"></rs-icon>
            </button>
          </mp-event-trigger>
        {{/if}}
      </div>
    </div>
  {{/if}}

  {{#if hideMediaSection}}
  {{else}}
    <div class="resource-card__media-container" style="{{#if autosize}}height:auto{{else}}max-height:142px;{{/if}}">

      {{#switch resourceOntologyClass}}

        {{#case "http://www.researchspace.org/ontology/EX_Digital_Image_Region" break=true}}
          <rs-iiif-image-thumbnail height='480' width='640' style='height: 100%; width: 100%;'
                                  image-or-region='{{iri}}'      
                                  [[> rsp:IIIFConfig]]>
          </rs-iiif-image-thumbnail>
        {{/case}}

        {{#case "http://iflastandards.info/ns/fr/frbr/frbroo/F26_Recording" break=true}}
          <semantic-query query='SELECT DISTINCT ?video WHERE { 
                                  <{{iri}}> crm:P129i_is_subject_of ?digital_object.
                                  <{{iri}}> crm:P2_has_type <http://www.researchspace.org/resource/system/vocab/resource_type/recording_video> .
                                  ?digital_object crm:P2_has_type <http://www.researchspace.org/resource/system/vocab/digital_object_type/web_link> .
                                  ?digital_object crm:P190_has_symbolic_content ?video .
                                } LIMIT 1'
                              
                          template='{{> template}}'
                          no-result-template='{{> noResults}}'>

                <template id='template'>
                        <div class="h100 w100">
                            <iframe src='{{bindings.0.video.value}}' 
                                    frameborder="0" 
                                    allow="accelerometer; encrypted-media; gyroscope; picture-in-picture" 
                                    width="100%" height="100%"
                                    allowfullscreen>
                            </iframe>
                        </div>
                </template>

                <template id="noResults">
                  [[> defaultCardIcon]]
                </template>
          </semantic-query>
        {{/case}}

        {{#default}}
          <mp-resource-thumbnail iri='{{iri}}' class="resource-card__thumbnail">
            <mp-resource-thumbnail-fallback>
              [[> defaultCardIcon]]
            </mp-resource-thumbnail-fallback>
          </mp-resource-thumbnail>
        {{/default}}

      {{/switch}}
    </div>
  {{/if}}

  <div class="resource-card__footer" style="{{#if hideMediaSection}}width: 200px;{{/if}}{{#if clipboardList}}width: calc(100% - 70px); height: 40px; gap: 0;{{/if}}">
    [[#if customFooter]]
      [[#block "customFooter"]][[/block]]
    [[else]]
      <div class="resource-card__footer-type color-secondary-light text-font-size__xsmall" style="{{#if clipboardList}}font-size:11px;{{/if}}">
        {{#if resourceLabel}}
          <span class="resource-card__footer-class" title="{{resourceLabel}}">{{resourceLabel}}</span>
        {{else}}
          <semantic-query query='SELECT ?ontologyClassLabel WHERE {
                                    BIND(<{{iri}}> as ?resource)
                                    ?resource a ?ontologyClass .
                                    ?ontologyClass a owl:Class .
                                    ?ontologyClass rdfs:label ?ontologyClassLabel .
                                    FILTER(LANG(?ontologyClassLabel)="en")
                                  } LIMIT 1'
                          template='{{> template}}'
                          no-result-template='{{> noResults}}'>
      
              <template id='template'>
                <span class="resource-card__footer-class" title="{{bindings.0.ontologyClassLabel.value}}">{{bindings.0.ontologyClassLabel.value}}</span>
              </template>

              <template id="noResults">
                {{#if data.types}}
                  [[!-- ontology class from KM props --]]
                    <div class="resource-card__footer-class">
                      <mp-label iri='{{data.types}}'></mp-label>
                    </div>
                {{/if}}
              </template>

          </semantic-query>
        {{/if}}
      </div>

      <div class="resource-card__footer-title">
        <mp-draggable iri='{{iri}}'>
          <div>
            {{#if (eq resourceConfig "http://www.researchspace.org/resource/system/resource_configurations_container/data/Knowledge_map")}}
              <mp-event-trigger id='{{iri}}-open-km-title-trigger' 
                              type='Dashboard.AddFrame'
                              data='{"viewId":"knowledge-map", 
                                      "resourceIri": "{{iri}}"}' 
                              targets='["thinking-frames"]'>
              
                <div><mp-label iri='{{iri}}' class="text-link"></mp-label>1</div>
              </mp-event-trigger>
            {{else}}
              <semantic-link  iri='http://www.researchspace.org/resource/ThinkingFrames'
                              urlqueryparam-view='{{#if (eq resourceConfig "http://www.researchspace.org/resource/system/resource_configurations_container/data/Semantic_narrative")}}semantic-narrative{{else}}resource-editor{{/if}}'
                              urlqueryparam-resource='{{iri}}'>
                {{#if label}}
                  [[!-- Label from KM props --]]
                  <span class="text-link" title="{{label}}">{{label}}2</span>
                {{else}}
                  <mp-label iri='{{iri}}' class="text-link" highlight='{{highlight}}' highlight-props='{"style": {"color": "#dc8a4b"}}'></mp-label>
                {{/if}}
              </semantic-link>
            {{/if}}
          </div>
        </mp-draggable>
      </div>
    [[/if]]
  </div>
</div>

[[#*inline "defaultCardIcon"]]
  <div class="h100 w100 resource-card__icon-container">
    {{#if resourceIcon}}
      <rs-icon icon-type="rounded" icon-name="{{resourceIcon}}" symbol=true></rs-icon>
    {{else}}
      <rs-icon icon-type="rounded" icon-name="bubble_chart" symbol=true></rs-icon>
    {{/if}}
    {{#if resourceLabel}}
      <div>{{resourceLabel}}</div>
    {{/if}}
  </div>
[[/inline]]