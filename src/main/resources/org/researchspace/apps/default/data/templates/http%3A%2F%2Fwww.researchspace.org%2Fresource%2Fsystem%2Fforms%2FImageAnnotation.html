<semantic-form [[> rsp:FormDefaults]] 
                persistence='{"type": "sparql", "targetGraphIri": "{{node}}/container/context"}'
                new-subject-template='/EX_Digital_Image_Region/{{{{raw}}}}{{UUID}}{{{{/raw}}}}'
                fields='[[fieldDefinitions
                            classtype="http://www.w3.org/1999/02/22-rdf-syntax-ns#type"
                            
                            image_annotation_label="http://www.researchspace.org/pattern/system/symbolic_object/has_symbolic_contentMin1Max1"
                            image_annotation_area_of_image="http://www.researchspace.org/pattern/system/image_annotation/area_of_image"
                            
                            image_annotation_bounding_box="http://www.researchspace.org/pattern/system/image_annotation/boundingBox"   												
    												image_annotation_viewport="http://www.researchspace.org/pattern/system/image_annotation/viewport"
    												
                          ]]'
              >
              
  <div class="form-scroll-area {{#if nested}}nested-form{{/if}}">
    <semantic-form-hidden-input for='classtype' default-value='http://www.researchspace.org/ontology/EX_Digital_Image_Region'> </semantic-form-hidden-input>

    <div class="form-inline-inputs" style="align-items:flex-end;">
      {{#if node}}
        <rs-iiif-image-thumbnail  height='480' width='640' style='height: 63px; width: 100px;'
                                  image-or-region='{{node}}'    
                                  [[> rsp:IIIFConfig]]
                                >
        </rs-iiif-image-thumbnail>
      {{/if}}
      
      <div style="flex: 1;">
        <semantic-form-text-input for='image_annotation_label' label='Image annotation name' placeholder='Enter image annotation name'></semantic-form-text-input>
      </div>
      
    </div>

    {{#if node}}
      <semantic-query query='SELECT ?image ?imageLabel WHERE {
                              <{{node}}> crmdig:L49_is_primary_area_of ?image .
                              ?image a rs:EX_Digital_Image .
                              ?image crm:P1_is_identified_by ?appellation . 
                              ?appellation a crm:E41_Appellation . 
                              ?appellation crm:P2_has_type <http://www.researchspace.org/resource/system/vocab/resource_type/primary_appellation> . 
                              ?appellation crm:P190_has_symbolic_content ?imageLabel .
                            } limit 1'

                      template='{{> template}}'>

          <template id='template'>
            <div>
              <div style="display: flex; align-items: baseline; column-gap: 5px;padding: 25px 0 5px 0px;">
                <h5 style="margin: 0;">Annotation of image:</h5>
                <semantic-link iri="http://www.researchspace.org/resource/ThinkingFrames"
                                    urlqueryparam-view='resource-editor' 
                                    urlqueryparam-resource-iri='{{bindings.0.image.value}}'
                                    class='text-link'
                                    >
                  <span class="text-link">{{bindings.0.imageLabel.value}}</span>
                </semantic-link>
              </div>
              <rs-iiif-image-thumbnail  height='40' width='45' style='border-radius: 1.5px;'
                                        image-or-region='{{bindings.0.image.value}}'      
                                        [[> rsp:IIIFConfig]]
                                        >
              </rs-iiif-image-thumbnail>
            </div>
          </template>
      </semantic-query>
    {{/if}}

  </div>
  
  <semantic-form-errors></semantic-form-errors>
  [[> rsp:FormDefaultActions formEntity='image annotation']]
</semantic-form>
