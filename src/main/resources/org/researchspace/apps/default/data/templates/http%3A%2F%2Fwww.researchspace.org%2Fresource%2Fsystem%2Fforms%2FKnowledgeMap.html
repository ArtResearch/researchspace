<semantic-form [[> rsp:FormDefaults]] 
                persistence='{"type": "sparql", "targetInsertGraphIri":"{{node}}/extended_context"}'
                fields='[[fieldDefinitions
                        kMap_description="http://www.researchspace.org/pattern/system/entity/description"
                  
                        image_main_representation="http://www.researchspace.org/pattern/system/entity/main_image"
                        more_image="http://www.researchspace.org/pattern/system/entity/images"
                            
                ]]'
              >
              
    <div class="form-scroll-area {{#if nested}}nested-form{{/if}}">
      [[!--  <semantic-form-hidden-input for="classtype" default-value='http://iflastandards.info/ns/fr/frbr/frbroo/F2_Expression'> </semantic-form-hidden-input>
        <semantic-form-hidden-input for="entity_resource_type" default-value='http://www.researchspace.org/resource/system/vocab/resource_type/knowledge_map'> </semantic-form-hidden-input>
        --]]
        <rs-tabs id="{{viewId}}-form-tabs" class-name="form-tabs">
            <rs-tab event-key="detail" title="Details">
                <div>
                 [[!--   <semantic-form-text-input for="kMap_title" label="Knowledge map title" 
                                                placeholder="Enter knowledge map title"> 
                    </semantic-form-text-input>
                     --]]   
                    
                    <semantic-form-text-input for="kMap_description" multiline=true label="Description/comment" 
                                                placeholder="Enter knowledge map description"> 
                    </semantic-form-text-input>
                </div>
            </rs-tab>

            {{#if node}}
                <rs-tab event-key="metadata" title="Metadata">

                    <semantic-query  query='SELECT ?knowledgeMap ?modifiedByUser ?modifiedAtTime WHERE {
                                                BIND(<{{node}}> AS ?knowledgeMap)

                                                ?knowledgeMap <http://www.w3.org/ns/prov#generatedAtTime> ?modifiedAtTime .

                                                [[#if (hasPermission "forms:ldp:*")]]
                                                    ?knowledgeMap <http://www.w3.org/ns/prov#wasAttributedTo> ?modifiedByUser .
                                                [[else]]
                                                    ?knowledgeMap <http://www.w3.org/ns/prov#wasAttributedTo> ?modifiedByUser .
                                                    FILTER(?modifiedByUser = <http://www.researchspace.org/resource/system/anonymousUser> )
                                                [[/if]]
                                            }'
                                            template='{{> template}}'
                                    >
                                        
                        <template id='template'>
                            <div class="semantic-form-input-title">Metadata</div>
                            <div class="table-expanded">
                                <table class="table metadata-table">
                                    <tbody>
                                        <tr>
                                            <td class="table-title"><b>modified</b></td>
                                            <td class="table-description">
                                                {{dateTimeFormat bindings.0.modifiedAtTime.value "DD/MM/YYYY, h:mm a"}}
                                            </td>
                                        </tr>
                                        <tr class="standard-row">
                                            <td class="table-title"><b>modified by</b></td>
                                            <td class="table-description">
                                                <rs-icon icon-type="round" icon-name="account_box" class="table-icon"></rs-icon>
                                                {{bindings.0.modifiedByUser.value}}
                                            </td>
                                        </tr>
                                    </tbody>   
                                </table>
                            </div>
                        </template>
                    </semantic-query>
                </rs-tab>
            {{/if}}
        </rs-tabs>
    </div>
  
    <semantic-form-errors></semantic-form-errors>

    [[> rsp:FormDefaultActions formEntity='{{#if entityType}}{{entityType}}{{else}}knowledge map{{/if}}']]

</semantic-form>