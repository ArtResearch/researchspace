{{#if node}}
  <semantic-query query='SELECT DISTINCT ?resourceTypeConfig ?resourceOntologyClass ?resourceTypeConfigLabel ?resourceTypeConfigFormIRI WHERE { 
    
                          <{{node}}> crm:P67_refers_to ?resourceTypeConfig .

                          ?resourceTypeConfig <http://www.researchspace.org/pattern/system/resource_configuration/resource_ontology_class> ?resourceOntologyClass  .
                          ?resourceTypeConfig crm:P71i_is_listed_in <http://www.researchspace.org/resource/system/resource_configurations_container> .
                          ?resourceTypeConfig <http://www.researchspace.org/pattern/system/resource_configuration/resource_name> ?resourceTypeConfigLabel .
                          ?resourceTypeConfig <http://www.researchspace.org/pattern/system/resource_configuration/resource_form> ?resourceTypeConfigFormIRI .
                        } LIMIT 1'>
    <template id='template'>
        {{> forms:AuthorityDocument_partial resource_type_config=bindings.0.resourceTypeConfig.value 
                                            resource_type_config=bindings.0.resourceTypeConfig.value 
                                            resourceOntologyClass=bindings.0.resourceOntologyClass.value 
                                            resource_type_form=bindings.0.resourceTypeConfigFormIRI.value}}
    </template>
  </semantic-query>
{{else}}
  <semantic-search id="{{viewId}}-vocabulary-iri-selector">
    <semantic-search-form-query id="{{viewId}}-newVocabulary-form"
                                element-id-to-hide-after-search="{{viewId}}-newAuthorityDocument-search-form"
                                query-template='{ "queryString": "SELECT $vocabularyLabel ?vocabularyDescription  { 
                                                                    BIND($label as ?vocabularyLabel).
                                                                    BIND($description as ?vocabularyDescription).
                                                                  }",
                                                
                                                    "arguments": { "label": {"type": "xsd:string"},
                                                                    "description": {"type": "xsd:string", "optional": true}
                                                                  }
                                                }'

                                fields='[{"iri": "http://www.researchspace.org/pattern/system/vocabularyLabel", "id": "label", "label": "Name", "xsdDatatype": "http://www.w3.org/2001/XMLSchema#string"},
                                        {"iri": "http://www.researchspace.org/pattern/system/vocabularyDescription", "id": "description", "label": "Description", "xsdDatatype": "http://www.w3.org/2001/XMLSchema#string"}
                                ]'>
                        
        <div id="{{viewId}}-newAuthorityDocument-search-form" class="vocabulary-search-form">
          <semantic-form-text-input for="label" placeholder="Enter authority document name" label="Authority document name" ></semantic-form-text-input> 
          <semantic-form-text-input for="description" placeholder="Enter description/comment" label="Description" multiline='true'></semantic-form-text-input>        

          <semantic-form-errors></semantic-form-errors>

          <div class="btn-form-actions" style="margin-top: 20px;">
            <div></div>
            <button name='submit' type="submit" class='btn btn-action'>Next</button>
          </div>
        </div>
    </semantic-search-form-query>

    <semantic-search-result-holder>
      <semantic-search-result>
        <semantic-query id='new-vocabulary-query-form' 
                        query='SELECT ?vocabularyLabel ?vocabulary ?vocabularyDescription ?exists ?viewId WHERE {
                                  BIND("{{viewId}}" as ?viewId)
                                  BIND(IRI(CONCAT(STR(Default:), "vocab/", ENCODE_FOR_URI(REPLACE(LCASE(?vocabularyLabel), "\\s", "_")))) AS ?vocabulary) .
                                  
                                  OPTIONAL {
                                    ?vocabulary a crm:E32_Authority_Document .
                                    BIND(true as ?exists) .
                                  }

                                }'

                        template='{{> template}}'>

          <template id='template'>
              {{#if bindings.0.exists}}
                <div>
                  <div id="{{bindings.0.viewId.value}}-newVocabulary-query-form-error-alert">

                    <div class="danger-documentation-section danger-documentation-section-withIcon">
                      <div class="danger-documentation-section-icon-container">
                        <rs-icon icon-type="round" icon-name="block"></rs-icon>
                      </div>
              
                      <div> 
                        <div class="danger-documentation-section-title">Already exists!</div>
                        <div class="danger-documentation-section-content">An authority document with name <b>{{bindings.0.vocabularyLabel.value}}</b> 
                          already exists.</div>
                      </div>
                    </div>

                    <div class="btn-inline-container" style="justify-content: flex-end; margin-top: 20px;">
                      <div></div>
                      <rs-back-button  element-id-to-show="{{bindings.0.viewId.value}}-newVocabulary-search-form" 
                                      error-alert-id="{{bindings.0.viewId.value}}-newVocabulary-query-form-error-alert"
                                      class-name="btn btn-action">
                        Back
                      </rs-back-button>
                    </div>
                  </div>
                </div>
              {{else}}
                <div id="{{bindings.0.viewId.value}}-newVocabulary-semantic-form">
                  <semantic-form id='{{bindings.0.viewId.value}}-new-authorityDocument-form' 
                                persistence='{"type": "sparql", "targetGraphIri": "{{bindings.0.vocabulary.value}}"}'
                                new-subject-template='{{bindings.0.vocabulary.value}}'
                                post-action="event"
                                fields='[[fieldDefinitions
                                          classtype="http://www.w3.org/1999/02/22-rdf-syntax-ns#type"
                                          vocabulary_refersto_resourceConfig="http://www.researchspace.org/pattern/system/vocabulary/refers_to_resourceConfig"
                                          authority_document_type="http://www.researchspace.org/pattern/system/authority_document/type"
                                          entity_description="http://www.researchspace.org/pattern/system/entity/description"
                                          entity_primary_appellation="http://www.researchspace.org/pattern/system/entity/primary_appellation"
                                          entity_formRecord="http://www.researchspace.org/pattern/system/entity/formRecord"
                                        ]]'
                  >
                    <div>
                      <semantic-form-hidden-input for="classtype" default-value="http://www.cidoc-crm.org/cidoc-crm/E32_Authority_Document"></semantic-form-hidden-input>
                      <semantic-form-hidden-input for="entity_primary_appellation" placeholder="Enter authority document name" label="Authority document name"
                                                  default-value='{{bindings.0.vocabularyLabel.value}}'>
                      </semantic-form-hidden-input>   
                      <div>
                        <span class="customFormHeader" style="margin-top: 0;">Authority document name<span style="margin-bottom: 2px; margin-left: 2px;">*</span></span>
                        <span>{{bindings.0.vocabularyLabel.value}}</span>
                      </div>

                      <semantic-form-tree-picker-input  for='authority_document_type' 
                                                        default-values='[{{#if docType}}"{{docType}}"{{/if}}]' 
                                                        label="Authority document type" 
                                                        placeholder="Select document type" 
                                                        close-dropdown-on-selection='true'
                                                        tree-patterns='{"scheme": "<http://www.researchspace.org/resource/vocab/authority_document_type>", 
                                                                        "schemePattern": "?item crm:P71i_is_listed_in <http://www.researchspace.org/resource/vocab/authority_document_type>",
                                                                        "relationPattern": "?item crm:P127_has_broader_term ?parent" }'

                                                        scheme-page-button-config='{"iri": "http://www.researchspace.org/resource/ThinkingFrames",
                                                                                    "view": "vocabulary-content",
                                                                                    "scheme": "http://www.researchspace.org/resource/vocab/authority_document_type",
                                                                                    "tooltip": "Open list of document types"
                                                                                  }'

                                                        nested-form-template='{{{{raw}}}}{{> forms:Type nested=true editable=true mode="new"
                                                                                            scheme="http://www.researchspace.org/resource/vocab/authority_document_type"
                                                                                            entityType="document type" }}
                                                                              {{{{/raw}}}}'

                                                        query-item-label='SELECT ?label WHERE {
                                                                                ?item skos:prefLabel ?label .
                                                                          }'>
                      </semantic-form-tree-picker-input>

                      <semantic-form-text-input for="entity_description"  placeholder="Enter description/comment" label="Description" multiline='true'
                                                  default-value='{{bindings.0.vocabularyDescription.value}}'>
                      </semantic-form-text-input>

                      <div style="display: flex; align-items: baseline; justify-content: space-between;">
                        <div class="customFormHeader">Resource type<span style="margin-bottom: 2px; margin-left: 2px;">*</span></div>
                        <div class="btn-inline-container">
                          <semantic-link-container uri='[[resolvePrefix "rsp:ThinkingFrames"]]'
                                                  urlqueryparam-view='resource-configuration'>
                            <button class="btn btn-default btn-textAndIcon" style="padding: 4px 10px; font-size: 13px;">
                              <rs-icon icon-type="round" icon-name="add_box"></rs-icon>
                              New resource type
                            </button>
                          </semantic-link-container>
                          <mp-popover title="Resource type">
                            <mp-popover-trigger placement="bottom" trigger='["hover", "click"]'>
                              <div class="badge badge--default">
                                <rs-icon icon-type="round" icon-name="question_mark"></rs-icon>
                              </div>
                            </mp-popover-trigger>
                            <mp-popover-content>
                                <p>Resource types are defined in 
                                  <b>Resource Configuration - Vocabulary / Authority tab</b>.
                                </p>
                                <div>To use a resource as authority type go in tab Vocabulary / Authority, enable <b>Use as Vocabulary / Authority type</b> and enter a
                                  <b>membership property</b>.</div>
                            </mp-popover-content>
                          </mp-popover>
                        </div>
                      </div>
                      
                      <semantic-form-select-input for="vocabulary_refersto_resourceConfig" render-header="false" placeholder='Select the type of the resources listed in the document' readonly-resource="true"></semantic-form-select-input>
                      [[> rsp:FormMetadataTab]]
                    </div>

                    <semantic-form-errors></semantic-form-errors>
                    
                    <!-- save and reset button for form -->
                    <div class="btn-form-actions" style="margin-top: 20px;">

                      <rs-back-button element-id-to-hide="{{bindings.0.viewId.value}}-newVocabulary-semantic-form" 
                                      element-id-to-show="{{bindings.0.viewId.value}}-newVocabulary-search-form">
                        Back
                      </rs-back-button>

                      <button name="submit" class="btn btn-action">Create authority document</button>
                    </div>

                  </semantic-form>
                </div>
              {{/if}}
          </template>
        </semantic-query>
      </semantic-search-result>
    </semantic-search-result-holder>
  </semantic-search>
{{/if}}

  <mp-event-proxy id='{{viewId}}-update-AuthorityDocumentForm-on-creation' 
                  on-event-source='{{viewId}}-new-authorityDocument-form'
                  on-event-types='["Form.ResourceCreated"]'
                  proxy-event-type='Component.TemplateUpdate'
                  proxy-targets='["{{viewId}}-term-forms", "http://www.researchspace.org/resource/system/resource_configurations_container/data/Authority_document-resourceSearch-frame"]'
                  additional-data='{"mode": "edit" }'
  ></mp-event-proxy>

[[!--
  <semantic-if query='ASK {<{{node}}> crm:P71_lists|^crm:P71i_is_listed_in ?resource }'
               then='{{> then}}'
               else='{{> else}}'>

    <template id='then'>
      {{> forms:AuthorityDocument_partial hasResource="true" }}
    </template>

    <template id='else'>
      {{> forms:AuthorityDocument_partial hasResource="false" }}
    </template>
  </semantic-if>
  --]]