<semantic-form 
               id='feature-creation-form'
               post-action='event'
               subject='{{feature}}'
               persistence='{"type": "sparql", "targetInsertGraphIri": "http://researchspace.org/text-annotations"}'
               
  						 fields='[[
                 fieldDefinitions
                   label="http://www.w3.org/2000/01/rdf-schema#label"
                   classtype="http://www.researchspace.org/pattern/image_observation/rdf:type"
                   P129_is_about="http://www.cidoc-crm.org/cidoc-crm/P129_is_about"
                   P01i_is_domain_of-refers-to="http://www.researchspace.org/pattern/image_observation/crmpc:P01i_is_domain_of-refers-to"
                   P190_has_symbolic_content="http://www.researchspace.org/pattern/crm:P190_has_symbolic_content"
									 P3_has_note="http://www.cidoc-crm.org/cidoc-crm/P3_has_note"
							]]'
>
  <mp-event-proxy id='refresh-the-form' on-event-source='feature-creation-form' on-event-types='["Form.ResourceCreated", "Form.ResourceUpdated"]'
                  proxy-event-type='Component.TemplateUpdate' proxy-targets='["save-state"]'
                  data='{"saved": true}'
  ></mp-event-proxy>


  <div class="form-scrollable-area">
    <semantic-form-hidden-input for="classtype" default-value="http://iflastandards.info/ns/fr/frbr/frbroo/F22_Self-Contained_Expression"> </semantic-form-hidden-input>
    <semantic-form-text-input for="label"> </semantic-form-text-input>
    
    <semantic-form-text-input for="P190_has_symbolic_content" label='Transcription' multiline='true'> </semantic-form-text-input>

    

    <semantic-form-tree-picker-input for="P129_is_about" label="Subject" scheme="http://collection.britishmuseum.org/id/thesauri/subject"></semantic-form-tree-picker-input>
      
    <semantic-form-composite-input for="P01i_is_domain_of-refers-to" 
                                     new-subject-template="/PC67_refers_to/{{{{raw}}}}{{UUID}}{{{{/raw}}}}"  
                                     fields='[[
                                       fieldDefinitions
                                         classtype="http://www.w3.org/1999/02/22-rdf-syntax-ns#type"
                                         P02_has_range-refers-to="http://www.researchspace.org/pattern/image_observation/crmpc:P02_has_range-refers-to"
                                         P67_1_has_type-kind-of-reference="http://www.researchspace.org/pattern/image_observation/crmpc:P67.1_has_type-kind-of-reference"
                                         P3_has_note="http://www.cidoc-crm.org/cidoc-crm/P3_has_note"
                                     ]]'
    >
        <semantic-form-hidden-input for="classtype" default-value='http://www.cidoc-crm.org/cidoc-crm/PC67_refers_to'> </semantic-form-hidden-input>
        <div style='height: 28px;'></div>
        <semantic-form-autocomplete-input for="P02_has_range-refers-to" render-header=false placeholder='Search for Person/Place/Period/Object/Thing'></semantic-form-autocomplete-input>
        <semantic-form-tree-picker-input for="P67_1_has_type-kind-of-reference" scheme="http://latehokusai.researchspace.org/resource/vocab/reference_type"></semantic-form-tree-picker-input>
        <semantic-form-text-input for="P3_has_note" label="Note about the Reference" multiline='true'> </semantic-form-text-input>
    </semantic-form-composite-input>
        	  
      </div>

  <div>
    <semantic-form-errors></semantic-form-errors>
  </div>
  
  <div class="form-btn-group">
    <div style="display: flex; justify-content: flex-end; width: 100%;">
      <mp-event-target-template-render id='save-state' template='{{> template}}'>
        <template id='template'>
          {{#if saved}}
          <div class='save-message fade-out_disappear'>
            The feature has been saved successfully!
          </div>
          {{/if}}
        </template>
      </mp-event-target-template-render>
      
      {{#if edit}}
        <button name="reset" class="btn btn-default">Reset</button>

        <mp-overlay-dialog show='{{#if delete}}true{{else}}false{{/if}}' id='feature-remove-confirmation-dialog' title="Remove feature" type="modal" bs-size="large">
          <mp-overlay-dialog-trigger>
            <button name="delete" class="btn btn-danger">Delete</button>
          </mp-overlay-dialog-trigger>
          <mp-overlay-dialog-content>
            <div>
              <div>
                <p>Are you sure you want to remove the feature '<strong><mp-label iri='{{feature}}'></mp-label></strong>' ?</p>
                <semantic-query 
                                query='
                                  SELECT ?resource WHERE {
                                    ?resource ?p <{{feature}}> .
                                  }
                                '
                                template='{{> referredByTemplate}}'
                >
                  <template id='referredByTemplate'>
                    Some entities in the system link to the feature:
                    <ul>
                      {{#each bindings}}
                        <li>
                          <semantic-link iri='{{resource.value}}'></semantic-link>
                        </li>
                      {{/each}}
                    </ul>
                  </template>
                </semantic-query>
              </div>
              <div class="form-btn-group">
                <div style="display: flex; justify-content: flex-end; width: 100%;">
                  <mp-event-trigger id='cancel-feature-removal' type='OverlayDialog.Close' targets='["feature-remove-confirmation-dialog"]'>
                    <button class="btn btn-default">Cancel</button>
                  </mp-event-trigger>
                  <mp-event-trigger id='confirm-feature-removal' type='Form.RemoveResource' data='{"iri": "{{feature}}"}' targets='["feature-creation-form"]'>
                    <button class="btn btn-danger">Delete Feature</button>
                  </mp-event-trigger>  
                  
                  
                  <mp-event-proxy id='close-form-removal-dialog' on-event-source='feature-creation-form' on-event-type='Form.ResourceRemoved'
                                  proxy-event-type='TwoSidePanel.ShowFront' data='{}' proxy-targets='["objects-panel"]'
                  ></mp-event-proxy>
                </div>
              </div>
            </div>
          </mp-overlay-dialog-content>
        </mp-overlay-dialog>
      {{/if}}
      
      <button name="submit" class="btn btn-primary">Save</button>
    </div>
  </div>
  
</semantic-form>
 
