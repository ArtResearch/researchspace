<mp-splitpane min-size=160 default-size=380 default-open='false' class="frame-split-pane">
  <div data-flex-layout="column top-stretch">
    <mp-splitpane-toggle-on>
      <button data-flex-layout="row center-left" class="btn-toggle-on">
        <div>File Upload</div>
        <i class="fa fa-angle-double-right"></i>
      </button>
    </mp-splitpane-toggle-on>
    <mp-splitpane-toggle-off>
      <div class="split-pane__leftsidebar-header">
        <button data-flex-layout='row center-left' class="btn-toggle-off">
          <div>
            File Upload
          </div>
          <div class="fa fa-angle-double-left" aria-hidden="true"></div>
        </button>
      </div>
    </mp-splitpane-toggle-off>
    <mp-splitpane-sidebar-open style="flex: 1;">
      <div class="split-pane__sidebar-open">
        [[#if (hasPermission "forms:ldp:*")]]
        <mp-event-target-template-render id='asset-upload-form-area' template='{{> assetUploadForm}}'>
          <template id='assetUploadForm'>
            <div class="asset-upload-form-types">
              <mp-event-trigger id='upload-image' type='Component.TemplateUpdate' data='{"assetType": "image"}' targets='["asset-upload-form-area"]'>
                <button class='btn-grey {{#ifCond assetType "==" "image"}}btn-selected{{/ifCond}}'>Image</button>
              </mp-event-trigger>
              <mp-event-trigger id='upload-pdf' type='Component.TemplateUpdate' data='{"assetType": "document"}' targets='["asset-upload-form-area"]'>
                <button class='btn-grey {{#ifCond assetType "==" "document"}}btn-selected{{/ifCond}}'>PDF document</button>
              </mp-event-trigger> 
              <mp-event-trigger id='upload-video' type='Component.TemplateUpdate' data='{"assetType": "video"}' targets='["asset-upload-form-area"]'>
                <button class='btn-grey {{#ifCond assetType "==" "video"}}btn-selected{{/ifCond}}'>Video</button>
              </mp-event-trigger>
              <mp-event-trigger id='upload-audio' type='Component.TemplateUpdate' data='{"assetType": "audio"}' targets='["asset-upload-form-area"]'>
                <button class='btn-grey {{#ifCond assetType "==" "audio"}}btn-selected{{/ifCond}}'>Audio</button>
              </mp-event-trigger>
            </div>
            {{#if assetType}}
              [[> AssetUploadForm]]
            {{/if}}
          </template>
        </mp-event-target-template-render>
        [[/if]]
      </div>
    </mp-splitpane-sidebar-open>
  </div>
  <div class="frame-container system-assets">
      <div class="frame-header">
        <h1 class="rs-main-title">Recent files</h1>
        <div class="page__main-top-actions"> 
          
        </div>
      </div>
      <div class="frame-content system-assets__cards-container">
        <semantic-search>
          <div class="system-assets__filter-actions">
            <semantic-search-query-keyword
                query='
                  SELECT ?subject WHERE { 
                    ?subject a rso:EX_Digital_Image .
                    ?subject rdfs:label ?label .
                    ?label bds:search ?__token__ ;
                                bds:minRelevance "0.3" ;
                                bds:matchAllTerms "true"  .
                  }
                '
                default-query='
                  SELECT ?subject WHERE {
                    ?subject a rso:EX_Digital_Image .
                  }
                '
                debounce=500
              ></semantic-search-query-keyword>
              <mp-selection-action-choice id='Action' title='With selected ...' selection='images-selection-aggregator'>
                <rs-iiif-overlay-action [[> rsp:IIIFConfig]]></rs-iiif-overlay-action>
                <rs-iiif-side-by-side-action [[> rsp:IIIFConfig]]></rs-iiif-side-by-side-action>
                  [[#if (hasPermission "forms:ldp:*")]]
                <mp-create-set-action></mp-create-set-action>
                [[/if]]
              </mp-selection-action-choice>
          </div>
          
          <div data-flex-layout="row stretch-stretch" class='rs-results-area'>
            <semantic-search-result-holder>
              <div data-flex-self="md-full">
                
                <semantic-search-result id='semantic-search-result'>
                    <semantic-table id='image-grid'
                              query='
                                SELECT DISTINCT ?subject ?container WHERE {
                                  OPTIONAL {
                                    ?subject crm:P1_is_identified_by/prov:generatedAtTime ?generated .
                                  }
                                  BIND(CONCAT(STR(?subject), "/container") AS ?container)
                                } ORDER BY DESC(?generated) ?subject
                                '
                              tuple-template='{{> gridItem }}',
                              options='{"showFilter":false, "resultsPerPage":30}'
                    >
                      <template id='gridItem'>
                        <div class='card-select-container'>
                          <div class='card-select-input'>
                            <mp-selection-toggle selection="images-selection-aggregator" tag="{{subject.value}}"></mp-selection-toggle>
                          </div>
                        <mp-draggable iri='{{subject.value}}'>
                          <div class="rs-card-container">
                            {{#> rsp:itemCardTemplate iri=subject.value cardMargin=6}}
                            
                              {{#*inline "hoverContent"}}
                                <div>
                                  <mp-selection-toggle selection="images-selection-aggregator" tag="{{subject.value}}"></mp-selection-toggle>
                                </div>
                              {{/inline}}
  
                              [[#if (hasPermission "forms:ldp:*")]]
                              {{#*inline "additionalActions"}}
                              
                                <div class="rs-default-card__hover-icon">
                                  <mp-ldp-remove-from-container-action 
                                    iri='{{container.value}}' 
                                    container='http://www.researchspace.org/resource/system/formContainer'
                                  >
                                    <button type="button" name='delete' class="rs-button" title="Delete">
                                      <i class="fa fa-trash-o" style="font-size: 23px; color: #fe4a60;"></i>
                                    </button>
                                  </mp-ldp-remove-from-container-action>
                                </div>
                              {{/inline}}
                              [[/if]]
                            {{/rsp:itemCardTemplate}}
  
                          </div>
                        </mp-draggable>
  
                      </div>
                      </template>
                    </semantic-table>   
                  </semantic-search-result>
              </div>
            </semantic-search-result-holder>
          </div>
        </semantic-search>
      </div>
  </div>
</mp-splitpane>

[[#*inline "AssetUploadForm"]]
  {{#switch assetType}}
    {{#case "image" break=true}}
      <semantic-context repository='assets'>
        <semantic-form new-subject-template='/EX_Digital_Image/{{UUID}}'
                        fields='[[fieldDefinitions
                    label="http://www.w3.org/2000/01/rdf-schema#label"
                    P3_has_note="http://www.cidoc-crm.org/cidoc-crm/P3_has_note"
                    P1_is_identified_by="http://www.cidoc-crm.org/cidoc-crm/P1_is_identified_by"
                    type="http://www.w3.org/1999/02/22-rdf-syntax-ns#type"
                  ]]'
                        >
          <semantic-form-hidden-input for='type' 
                                      default-values='["http://www.researchspace.org/ontology/EX_Digital_Image"]'
                                      > </semantic-form-hidden-input>

          <semantic-form-file-input for='P1_is_identified_by' 
                                    accept-pattern='image/*' 
                                    storage='images'
                                    temp-storage='tmp'
                                    placeholder='Please drag&drop your image here'
                                    from-url-or-drop=true
                                    name-predicate-iri='http://www.researchspace.org/ontology/PX_has_file_name'
                                    media-type-predicate-iri='http://www.researchspace.org/ontology/PX_has_media_type'
                                    resource-query='
                                        PREFIX rso: <http://www.researchspace.org/ontology/>
                                        CONSTRUCT {
                                          ?__resourceIri__ a rso:EX_File.
                                          ?__resourceIri__ rso:PX_has_file_name ?__fileName__.
                                          ?__resourceIri__ rso:PX_has_media_type ?__mediaType__.
                                        } WHERE {}

                                    '
                                    generate-iri-query='
                                      SELECT ?resourceIri {
                                        BIND(IRI(CONCAT(STR(Default:), "EX_File/", ?__fileName__)) AS ?resourceIri) .
                                      }

                                    '
                                    ></semantic-form-file-input>
          <semantic-form-text-input for='label'></semantic-form-text-input>
          <semantic-form-text-input for='P3_has_note' multiline=true></semantic-form-text-input>

          <div class='form-btn-group'>
            <button name="reset" class="btn btn-sm btn-default">Reset</button>
            <button name="submit" class="btn btn-sm btn-primary">Save</button>
          </div>
        </semantic-form>
      </semantic-context>
    {{/case}}
    
    {{#case "document" break=true}}
    <div>document</div>
    {{/case}}
  {{/switch}}
[[/inline]]