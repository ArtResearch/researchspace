<mp-splitpane min-size=160 default-size=380 default-open='false' class="frame-split-pane">
  <div data-flex-layout="column top-stretch">
    <mp-splitpane-toggle-on>
      <button data-flex-layout="row center-left" class="btn-toggle-on">
        <div>File Upload</div>
        <i class="fa fa-angle-double-right"></i>
      </button>
    </mp-splitpane-toggle-on>
    <mp-splitpane-toggle-off>
      <div class="split-pane__leftsidebar-header">
        <button data-flex-layout='row center-left' class="btn-toggle-off">
          <div>
            File Upload
          </div>
          <div class="fa fa-angle-double-left" aria-hidden="true"></div>
        </button>
      </div>
    </mp-splitpane-toggle-off>
    <mp-splitpane-sidebar-open style="flex: 1; overflow: hidden;">
      <div class="split-pane__sidebar-open asset-uploads">
        [[#if (hasPermission "forms:ldp:*")]]
        <mp-event-target-template-render id='asset-upload-form-area' template='{{> assetUploadForm}}'>
          <template id='assetUploadForm'>
            <div class="asset-uploads-container">
              <div class="asset-upload-form-types">
                {{#if assetType}}
                  <mp-event-trigger id='upload-image' type='Component.TemplateUpdate' data='{"assetType": "image"}' targets='["asset-upload-form-area"]'>
                    <button class='btn-grey {{#ifCond assetType "==" "image"}}btn-selected{{/ifCond}}'>Image</button>
                  </mp-event-trigger>
                {{else}}
                  <button class='btn-grey btn-selected'>Image</button>
                {{/if}}
                <mp-event-trigger id='upload-pdf' type='Component.TemplateUpdate' data='{"assetType": "document"}' targets='["asset-upload-form-area"]'>
                  <button class='btn-grey {{#ifCond assetType "==" "document"}}btn-selected{{/ifCond}}'>PDF document</button>
                </mp-event-trigger> 
                <mp-event-trigger id='upload-video' type='Component.TemplateUpdate' data='{"assetType": "video"}' targets='["asset-upload-form-area"]'>
                  <button class='btn-grey {{#ifCond assetType "==" "video"}}btn-selected{{/ifCond}}'>Video</button>
                </mp-event-trigger>
                <mp-event-trigger id='upload-audio' type='Component.TemplateUpdate' data='{"assetType": "audio"}' targets='["asset-upload-form-area"]'>
                  <button class='btn-grey {{#ifCond assetType "==" "audio"}}btn-selected{{/ifCond}}'>Audio</button>
                </mp-event-trigger>
              </div>
              <div class="asset-upload-form">
                {{#switch assetType}}
                {{#case "document" break=true}}
                <div>doc form</div>
                {{/case}}
              
                {{#case "video" break=true}}
                <div>video form</div>
                {{/case}}
              
                {{#case "audio" break=true}}
                <div>audio form</div>
                {{/case}}
    
                {{#default}}
                  <semantic-context repository='assets'>
                    <semantic-form new-subject-template='/EX_Digital_Image/{{UUID}}'
                                    fields='[[fieldDefinitions
                                label="http://www.w3.org/2000/01/rdf-schema#label"
                                P3_has_note="http://www.cidoc-crm.org/cidoc-crm/P3_has_note"
                                P1_is_identified_by="http://www.cidoc-crm.org/cidoc-crm/P1_is_identified_by"
                                type="http://www.w3.org/1999/02/22-rdf-syntax-ns#type"
                              ]]'
                                    >
                      <semantic-form-hidden-input for='type' 
                                                  default-values='["http://www.researchspace.org/ontology/EX_Digital_Image"]'
                                                  > </semantic-form-hidden-input>
            
                      <semantic-form-file-input for='P1_is_identified_by' 
                                                accept-pattern='image/*' 
                                                storage='images'
                                                temp-storage='tmp'
                                                placeholder='Please drag&drop your image here'
                                                from-url-or-drop=true
                                                name-predicate-iri='http://www.researchspace.org/ontology/PX_has_file_name'
                                                media-type-predicate-iri='http://www.researchspace.org/ontology/PX_has_media_type'
                                                resource-query='
                                                    PREFIX rso: <http://www.researchspace.org/ontology/>
                                                    CONSTRUCT {
                                                      ?__resourceIri__ a rso:EX_File.
                                                      ?__resourceIri__ rso:PX_has_file_name ?__fileName__.
                                                      ?__resourceIri__ rso:PX_has_media_type ?__mediaType__.
                                                    } WHERE {}
            
                                                '
                                                generate-iri-query='
                                                  SELECT ?resourceIri {
                                                    BIND(IRI(CONCAT(STR(Default:), "EX_File/", ?__fileName__)) AS ?resourceIri) .
                                                  }
                                                '
                                                ></semantic-form-file-input>
                      <semantic-form-text-input for='label'></semantic-form-text-input>
                      <semantic-form-text-input for='P3_has_note' multiline=true></semantic-form-text-input>
            
                      <div class='form-btn-group'>
                        <button name="reset" class="btn btn-default">Reset</button>
                        <button name="submit" class="btn btn-primary">Save</button>
                      </div>
                    </semantic-form>
                  </semantic-context>
                {{/default}}
              {{/switch}}
              </div>
            </div>
            
          </template>
        </mp-event-target-template-render>
        [[/if]]

      </div>
    </mp-splitpane-sidebar-open>
  </div>
  
  <mp-event-target-template-render id='asset-display-area' template='{{> assetDisplay}}'>
    <template id='assetDisplay'>
      <div class="frame-container asset-display">
        <div class="frame-header">
          <h1 class="rs-main-title">Recent files</h1>
          <div class="asset-display-types">
            {{#if assetDisplayType}}
              <mp-event-trigger id='display-image' type='Component.TemplateUpdate' data='{"assetDisplayType": "image"}' targets='["asset-display-area"]'>
                <button class='btn-grey {{#ifCond assetDisplayType "==" "image"}}btn-selected{{/ifCond}}'>Images</button>
              </mp-event-trigger>
            {{else}}
              <button class='btn-grey btn-selected'>Image</button>
            {{/if}}
            <mp-event-trigger id='display-pdf' type='Component.TemplateUpdate' data='{"assetDisplayType": "document"}' targets='["asset-display-area"]'>
              <button class='btn-grey {{#ifCond assetDisplayType "==" "document"}}btn-selected{{/ifCond}}'>PDF documents</button>
            </mp-event-trigger> 
            <mp-event-trigger id='display-video' type='Component.TemplateUpdate' data='{"assetDisplayType": "video"}' targets='["asset-display-area"]'>
              <button class='btn-grey {{#ifCond assetDisplayType "==" "video"}}btn-selected{{/ifCond}}'>Videos</button>
            </mp-event-trigger>
            <mp-event-trigger id='display-audio' type='Component.TemplateUpdate' data='{"assetDisplayType": "audio"}' targets='["asset-display-area"]'>
              <button class='btn-grey {{#ifCond assetDisplayType "==" "audio"}}btn-selected{{/ifCond}}'>Audios</button>
            </mp-event-trigger>
          </div>
        </div>
        <div class="frame-content asset-display-results">
          {{#switch assetDisplayType}}
            {{#case "document" break=true}}
            <div>doc</div>
            {{/case}}
          
            {{#case "video" break=true}}
            <div>video</div>
            {{/case}}
          
            {{#case "audio" break=true}}
            <div>audio</div>
            {{/case}}

            {{#default}}
              <semantic-search>
                <div class="asset-display__filter-actions">
                  <semantic-search-query-keyword
                      query='
                        SELECT ?subject WHERE { 
                          ?subject a rso:EX_Digital_Image .
                          ?subject rdfs:label ?label .
                          ?label bds:search ?__token__ ;
                                      bds:minRelevance "0.3" ;
                                      bds:matchAllTerms "true"  .
                        }
                      '
                      default-query='
                        SELECT ?subject WHERE {
                          ?subject a rso:EX_Digital_Image .
                        }
                      '
                      debounce=500
                    ></semantic-search-query-keyword>
                    <mp-selection-action-choice id='Action' title='With selected ...' selection='images-selection-aggregator'>
                      <rs-iiif-overlay-action [[> rsp:IIIFConfig]]></rs-iiif-overlay-action>
                      <rs-iiif-side-by-side-action [[> rsp:IIIFConfig]]></rs-iiif-side-by-side-action>
                        [[#if (hasPermission "forms:ldp:*")]]
                      <mp-create-set-action></mp-create-set-action>
                      [[/if]]
                    </mp-selection-action-choice>
                </div>
                
                <div data-flex-layout="row stretch-stretch" class='rs-results-area'>
                  <semantic-search-result-holder>
                    <div data-flex-self="md-full">
                      
                      <semantic-search-result id='semantic-search-result'>
                          <semantic-table id='image-grid'
                                    query='
                                      SELECT DISTINCT ?subject ?container WHERE {
                                        OPTIONAL {
                                          ?subject crm:P1_is_identified_by/prov:generatedAtTime ?generated .
                                        }
                                        BIND(CONCAT(STR(?subject), "/container") AS ?container)
                                      } ORDER BY DESC(?generated) ?subject
                                      '
                                    tuple-template='{{> gridItem }}',
                                    options='{"showFilter":false, "resultsPerPage":30}'
                          >
                            <template id='gridItem'>
                              <div class='card-select-container'>
                                <div class='card-select-input'>
                                  <mp-selection-toggle selection="images-selection-aggregator" tag="{{subject.value}}"></mp-selection-toggle>
                                </div>
                              <mp-draggable iri='{{subject.value}}'>
                                <div class="rs-card-container">
                                  {{#> rsp:itemCardTemplate iri=subject.value}}
                                  
                                    {{#*inline "hoverContent"}}
                                      <div>
                                        <mp-selection-toggle selection="images-selection-aggregator" tag="{{subject.value}}"></mp-selection-toggle>
                                      </div>
                                    {{/inline}}
              
                                    [[#if (hasPermission "forms:ldp:*")]]
                                    {{#*inline "additionalActions"}}
                                    
                                      <div class="rs-default-card__hover-icon">
                                        <mp-ldp-remove-from-container-action 
                                          iri='{{container.value}}' 
                                          container='http://www.researchspace.org/resource/system/formContainer'
                                        >
                                          <button type="button" name='delete' class="rs-button" title="Delete">
                                            <i class="fa fa-trash-o" style="font-size: 23px;"></i>
                                          </button>
                                        </mp-ldp-remove-from-container-action>
                                      </div>
                                    {{/inline}}
                                    [[/if]]
                                  {{/rsp:itemCardTemplate}}
              
                                </div>
                              </mp-draggable>
              
                            </div>
                            </template>
                          </semantic-table>
                        </semantic-search-result>
                    </div>
                  </semantic-search-result-holder>
                </div>
              </semantic-search>
            {{/default}}
          {{/switch}}
        </div>
      </div>
    </template>
  </mp-event-target-template-render>
</mp-splitpane>
